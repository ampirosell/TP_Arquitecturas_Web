{
  "info": {
    "_postman_id": "f9931c68-6c0b-4f67-9ad3-5bde748076fb",
    "name": "Microservicios Grupo8",
    "description": "Colección reorganizada para ejecutar el flujo principal end-to-end y consultar los CRUD de cada microservicio por separado.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "anio_busqueda",
      "value": "2025"
    },
    {
      "key": "mes_inicio_actual",
      "value": "10"
    },
    {
      "key": "mes_fin_actual",
      "value": "12"
    },
    {
      "key": "minutos_viaje",
      "value": "60"
    },
    {
      "key": "kilometros_recorridos",
      "value": "3.5"
    },
    {
      "key": "pausa_extendida",
      "value": "false"
    },
    {
      "key": "min_viajes",
      "value": "1"
    }
  ],
  "item": [
    {
      "name": "Flujo Principal",
      "description": "Ejecución recomendada paso a paso: crear datos base, iniciar viaje, registrar pausa opcional, finalizar viaje y consultar reportes.",
      "item": [
        {
          "name": "01 - Crear usuario base",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nombre\": \"Hugo\",\n  \"apellido\": \"Ferrari\",\n  \"mail\": \"hugo@example.com\",\n  \"telefono\": \"+54 9 11 5555 5555\",\n  \"rol\": \"ADMIN\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{user_base_url}}/users"
          }
        },
        {
          "name": "02 - Crear cuenta para el usuario",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"idUsuario\": {{user_id}},\n  \"monto\": 1200.0,\n  \"tipo\": \"BASICA\",\n  \"fecha_alta\": \"2025-11-12T00:00:00\",\n  \"cuentaActiva\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{cuenta_base_url}}/cuenta"
          }
        },
        {
          "name": "03 - Asegurar cuenta activa",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"activa\": true\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{cuenta_base_url}}/cuenta/{{cuenta_id}}/estado"
          }
        },
        {
          "name": "04 - Crear parada",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"direccion\": \"Av. Siempreviva 742\",\n  \"nombre\": \"Parada Centro\",\n  \"latitud\": {{latitud}},\n  \"longitud\": {{longitud}},\n  \"monopatinIds\": []\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{parada_base_url}}/paradas"
          }
        },
        {
          "name": "05 - Crear monopatín (LIBRE)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"idMonopatin\": {{monopatin_id}},\n  \"estadoMonopatin\": \"LIBRE\",\n  \"kmRecorridos\": 0,\n  \"viajeId\": null,\n  \"latitud\": {{latitud}},\n  \"longitud\": {{longitud}},\n  \"paradaId\": {{parada_id}}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{monopatin_base_url}}/monopatines"
          }
        },
        {
          "name": "06 - Crear tarifa vigente",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"precioPorKm\": 40.0,\n  \"precioPorMinuto\": 5.0,\n  \"recargoPausa\": 20.0,\n  \"fechaInicio\": \"2025-11-01\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{facturacion_base_url}}/tarifas"
          }
        },
        {
          "name": "07 - Iniciar viaje (valida cuenta y monopatín)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_user}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"idCuenta\": {{cuenta_id}},\n  \"idUsuario\": {{user_id}},\n  \"idMonopatin\": {{monopatin_id}}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{viaje_base_url}}/viajes/start"
          }
        },
        {
          "name": "08 - Registrar pausa (opcional)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_user}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fechaInicio\": \"2025-11-12T17:15:00\",\n  \"fechaFin\": \"2025-11-12T17:25:00\",\n  \"pausaTotal\": 10,\n  \"viaje\": {\n    \"idViaje\": {{viaje_id}}\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{viaje_base_url}}/pausas"
          }
        },
        {
          "name": "09 - Finalizar pausa (opcional)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_user}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fechaInicio\": \"2025-11-12T17:15:00\",\n  \"fechaFin\": \"2025-11-12T17:30:00\",\n  \"pausaTotal\": 15,\n  \"viaje\": {\n    \"idViaje\": {{viaje_id}}\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{viaje_base_url}}/pausas/{{pausa_id}}"
          }
        },
        {
          "name": "10 - Finalizar viaje (actualiza flota y factura)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-User-Role",
                "value": "{{rol_user}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"kilometrosRecorridos\": 3.5,\n  \"paradaId\": {{parada_id}},\n  \"latitud\": {{latitud}},\n  \"longitud\": {{longitud}}\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": "{{viaje_base_url}}/viajes/{{viaje_id}}/finalizar"
          }
        },
        {
          "name": "11 - Total facturado en rango de meses",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "url": "{{facturacion_base_url}}/facturacion/total-mensual?anio={{anio_busqueda}}&mesInicio={{mes_inicio_actual}}&mesFin={{mes_fin_actual}}"
          }
        },
        {
          "name": "12 - Reporte de uso por kilómetros",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "url": "{{viaje_base_url}}/viajes/reportes/kilometros?desde={{reporte_desde}}&hasta={{reporte_hasta}}&incluirPausas=true"
          }
        },
        {
          "name": "13 - Monopatines con más viajes",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "url": "{{viaje_base_url}}/viajes/reportes/monopatines-frecuentes?anio={{anio_busqueda}}&minViajes={{min_viajes}}"
          }
        },
        {
          "name": "14 - Resumen estados de monopatines",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "X-User-Role",
                "value": "{{rol_admin}}"
              }
            ],
            "url": "{{monopatin_base_url}}/monopatines/resumen/estado"
          }
        }
      ]
    },
    {
      "name": "CRUD por Servicio",
      "description": "Referencia de endpoints de cada microservicio agrupados por dominio.",
      "item": [
        {
          "name": "User",
          "item": [
            {
              "name": "Listar usuarios",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{user_base_url}}/users"
              }
            },
            {
              "name": "Buscar usuario por ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{user_base_url}}/users/{{user_id}}"
              }
            },
            {
              "name": "Crear usuario",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"nombre\": \"Juan\",\n  \"apellido\": \"Pérez\",\n  \"mail\": \"juan@example.com\",\n  \"telefono\": \"1234-5678\",\n  \"rol\": \"USER\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": "{{user_base_url}}/users"
              }
            }
          ]
        },
        {
          "name": "Parada",
          "item": [
            {
              "name": "Listar paradas",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_user}}"
                  }
                ],
                "url": "{{parada_base_url}}/paradas"
              }
            },
            {
              "name": "Buscar parada por ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_user}}"
                  }
                ],
                "url": "{{parada_base_url}}/paradas/{{parada_id}}"
              }
            },
            {
              "name": "Crear parada",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"direccion\": \"Av. Santa Fe 123\",\n  \"nombre\": \"Parada Norte\",\n  \"latitud\": -34.58,\n  \"longitud\": -58.40,\n  \"monopatinIds\": []\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": "{{parada_base_url}}/paradas"
              }
            }
          ]
        },
        {
          "name": "Monopatín",
          "item": [
            {
              "name": "Listar monopatines",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{monopatin_base_url}}/monopatines"
              }
            },
            {
              "name": "Buscar monopatín por ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{monopatin_base_url}}/monopatines/{{monopatin_id}}"
              }
            },
            {
              "name": "Actualizar estado (manual)",
              "request": {
                "method": "PATCH",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_mantenimiento}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"estado\": \"LIBRE\",\n  \"viajeId\": null\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": "{{monopatin_base_url}}/monopatines/{{monopatin_id}}/estado"
              }
            },
            {
              "name": "Registrar mantenimiento",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_mantenimiento}}"
                  }
                ],
                "url": "{{monopatin_base_url}}/monopatines/{{monopatin_id}}/mantenimiento"
              }
            },
            {
              "name": "Finalizar mantenimiento",
              "request": {
                "method": "DELETE",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_mantenimiento}}"
                  }
                ],
                "url": "{{monopatin_base_url}}/monopatines/{{monopatin_id}}/mantenimiento"
              }
            }
          ]
        },
        {
          "name": "Viaje",
          "item": [
            {
              "name": "Listar viajes",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{viaje_base_url}}/viajes"
              }
            },
            {
              "name": "Buscar viaje por ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{viaje_base_url}}/viajes/{{viaje_id}}"
              }
            },
            {
              "name": "Crear viaje manual (sin validaciones)",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"fechaInicio\": \"2025-11-12T17:00:00\",\n  \"fechaFin\": \"2025-11-12T17:30:00\",\n  \"kmRecorridos\": 2.0,\n  \"pausa\": false,\n  \"idMonopatin\": {{monopatin_id}},\n  \"idUsuario\": {{user_id}}\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": "{{viaje_base_url}}/viajes"
              }
            },
            {
              "name": "Listar pausas",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{viaje_base_url}}/pausas"
              }
            }
          ]
        },
        {
          "name": "Cuenta",
          "item": [
            {
              "name": "Listar cuentas",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{cuenta_base_url}}/cuenta"
              }
            },
            {
              "name": "Buscar cuenta por ID",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{cuenta_base_url}}/cuenta/{{cuenta_id}}"
              }
            },
            {
              "name": "Crear cuenta",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"idUsuario\": {{user_id}},\n  \"monto\": 800.0,\n  \"tipo\": \"PREMIUM\",\n  \"fecha_alta\": \"2025-11-12T00:00:00\",\n  \"cuentaActiva\": true\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": "{{cuenta_base_url}}/cuenta"
              }
            }
          ]
        },
        {
          "name": "Facturación y Tarifas",
          "item": [
            {
              "name": "Generar factura manual",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{facturacion_base_url}}/facturacion/generar?idCuenta={{cuenta_id}}&idViaje={{viaje_id}}&km={{kilometros_recorridos}}&minutos={{minutos_viaje}}&pausaExtendida={{pausa_extendida}}"
              }
            },
            {
              "name": "Obtener tarifa vigente",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{facturacion_base_url}}/tarifas/vigente"
              }
            },
            {
              "name": "Crear tarifa",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"precioPorKm\": 30.0,\n  \"precioPorMinuto\": 4.0,\n  \"recargoPausa\": 15.0,\n  \"fechaInicio\": \"2025-10-01\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": "{{facturacion_base_url}}/tarifas"
              }
            },
            {
              "name": "Total facturado (fecha a fecha)",
              "request": {
                "method": "GET",
                "header": [
                  {
                    "key": "X-User-Role",
                    "value": "{{rol_admin}}"
                  }
                ],
                "url": "{{facturacion_base_url}}/facturacion/total?desde={{reporte_desde}}&hasta={{reporte_hasta}}"
              }
            }
          ]
        }
      ]
    }
  ]
}